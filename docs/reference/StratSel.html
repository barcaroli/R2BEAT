<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Stratification and selection — StratSel • R2BEAT </title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



  <link href="../extra.css" rel="stylesheet">
  

<meta property="og:title" content="Stratification and selection — StratSel" />
<meta property="og:description" content="Merge two data frames (whatever PSU population and allocation data frames) and then compute stratification and selection of a fixed number of sample PSUs (Primary Sampling Units) for stratum using the Sampford's method (unequal probabilities, without replacement, fixed sample size), implemented by the UPsampford function of R package sampling. About the stratification, the function realizes for each domain estimation, the computation of a size threshold for a given size PSU. PSUs with measure of size that exceeds a calculated threshold are identify like SR (Self Representative) and each constitutes a stratum by itself, so they come into the sample with probability equal to one. The remaining NSR (Non Self Representative) PSUs are ordered for the measure of size and divided into stratum having size approximately constant to the corrected threshold and with PSUs having sizes as homogeneous as possible.
If the number of NSR PSUs in each stratum is greater than the number of sample PSUs for each stratum, then it is indispensable to define the vector of the inclusion probabilities (pik), argument of UPsampford function, vice versa NSR PSUs will become SR PSUs. If some pik values are greater than 1, pik is newly calculated, for those PSUs belonging to the same domain and stratum of the PSUs having pik &amp;gt;1, until pik values will be all less than 1, then applies the UPsampford function." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-156656860-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-156656860-1');
</script>


  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">R2BEAT </a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/R2BEAT_methodology.html">R2BEAT methodology and use</a>
    </li>
    <li>
      <a href="../articles/R2BEAT_workflow.html">R2BEAT two-stage sampling design workflow</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/barcaroli/R2BEAT/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Stratification and selection</h1>
    
    <div class="hidden name"><code>StratSel.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Merge two data frames (whatever PSU population and allocation data frames) and then compute stratification and selection of a fixed number of sample PSUs (Primary Sampling Units) for stratum using the Sampford's method (unequal probabilities, without replacement, fixed sample size), implemented by the UPsampford function of R package <em>sampling</em>. About the stratification, the function realizes for each domain estimation, the computation of a size threshold for a given size PSU. PSUs with measure of size that exceeds a calculated threshold are identify like SR (Self Representative) and each constitutes a stratum by itself, so they come into the sample with probability equal to one. The remaining NSR (Non Self Representative) PSUs are ordered for the measure of size and divided into stratum having size approximately constant to the corrected threshold and with PSUs having sizes as homogeneous as possible.<br />
If the number of NSR PSUs in each stratum is greater than the number of sample PSUs for each stratum, then it is indispensable to define the vector of the inclusion probabilities (pik), argument of UPsampford function, vice versa NSR PSUs will become SR PSUs. If some pik values are greater than 1, pik is newly calculated, for those PSUs belonging to the same domain and stratum of the PSUs having pik &gt;1, until pik values will be all less than 1, then applies the UPsampford function.</p>
    </div>

    <pre class="usage"><span class='fu'>StratSel</span>(<span class='kw'>dataPop</span>, <span class='kw'>idpsu</span>, <span class='kw'>dom</span>, <span class='kw'>final_pop</span>, <span class='kw'>size</span>, <span class='kw'>PSUsamplestratum</span>, <span class='kw'>min_sample</span>, 
    min_sample_index = <span class='fl'>FALSE</span>, <span class='kw'>dataAll</span>, <span class='kw'>domAll</span>, <span class='kw'>f_sample</span>,
    planned_min_sample = <span class='kw'>NULL</span>, launch = <span class='fl'>TRUE</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>dataPop</th>
      <td><p>PSU population data frame.</p></td>
    </tr>
    <tr>
      <th>idpsu</th>
      <td><p>Formula identifying primary sample units identifier.</p></td>
    </tr>
    <tr>
      <th>dom</th>
      <td><p>Formula identifying the variable domain.</p></td>
    </tr>
    <tr>
      <th>final_pop</th>
      <td><p>Formula identifying secondary stage units.</p></td>
    </tr>
    <tr>
      <th>size</th>
      <td><p>Formula identifying first stage units size.</p></td>
    </tr>
    <tr>
      <th>PSUsamplestratum</th>
      <td><p>Number of sample PSUs to select to each stratum.</p></td>
    </tr>
    <tr>
      <th>min_sample</th>
      <td><p>Number of final sample units to observe in each PSU.</p></td>
    </tr>
    <tr>
      <th>min_sample_index</th>
      <td><p>Identify the absence of planned_min_sample (default = <code>FALSE</code>)</p></td>
    </tr>
    <tr>
      <th>dataAll</th>
      <td><p>Allocation data frame.</p></td>
    </tr>
    <tr>
      <th>domAll</th>
      <td><p>Formula identifying the domain variable for allocation data frame.</p></td>
    </tr>
    <tr>
      <th>f_sample</th>
      <td><p>Formula identifying final sample units.</p></td>
    </tr>
    <tr>
      <th>planned_min_sample</th>
      <td><p>Formula identifying planned final sample units to observe in each PSU, variable between domains; <code>NULL</code> (the default)
  means the existence of a fixed number of them identify from min_sample.</p></td>
    </tr>
    <tr>
      <th>launch</th>
      <td><p>Identify the parameter related to the launch procedure. If default = <code>TRUE</code> the launch is partial (see 'Details').</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>It is possible to launch the procedure in two separate steps, so that user can see a first output (launch = <code>TRUE</code>) and decide if modify the input parameters or continue the procedure setting launch = <code>FALSE</code>.</p>
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An object of class <code>list</code> or <code>data.frame</code> depending from argument <code>launch</code>. If launch = <code>TRUE</code> the only output is, at domain level, a data frame of the Self Representative (SR) PSUs and of the Non Self Representative (NSR) PSUs before stratification. If launch = <code>FALSE</code> the output is a <code>list</code> composed by four members of <code>data.frame</code> class. The first component, at domain level, is the same data frame obtained if launch = <code>TRUE</code>. The second element
is, at domain level, a data frame of SR and NSR PSUs after stratification, with their totals like the first output, but with additional information such as the final units sample size distinctly for SR and NSR PSUs and their mean. The third component is a data frame that supply, for each stratum, the number of sample PSUs selected and the total number of PSUs. The fourth element provides, for each PSU, some information like the inclusion probability and the sampling fraction.</p>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Raffaella Cianchetta</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>S. Falorsi A. Russo (2001), Il disegno di rilevazione per indagini Panel sulle famiglie, <em>Rivista di Statistica Ufficiale, N. 3</em>, p. 55-90.<br />
Sampford, M. (1967), On sampling without replacement with unequal probabilities of selection, <em>Biometrika</em>, 54:499-513.<br />
Yves Tille' and Alina Matei (2012). sampling: Survey Sampling. R package version 2.5. <br />
http://CRAN.R-project.org/package=sampling.<br /></p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># Start StratSel</span>
<span class='co'>if</span> (<span class='fl'>FALSE</span>) {
<span class='fu'><a href='https://rdrr.io/r/base/load.html'>load</a></span>(<span class='kw'>FS4</span>)
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='kw'>population</span>)
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='kw'>allocation</span>)

<span class='co'># The function with a fixed number of final sample units (min_sample= 8) </span>
<span class='co'># to observe in each PSU and partial launch of the procedure with</span>
<span class='co'># only one output data frame(see 'Value')   </span>
<span class='kw'>Output_list</span> <span class='op'>&lt;-</span> <span class='fu'>StratSel</span>(dataPop= <span class='kw'>population</span>, idpsu= <span class='op'>~</span> <span class='kw'>comune_num</span>, dom= <span class='op'>~</span> <span class='kw'>dom</span>,
               final_pop= <span class='op'>~</span> <span class='kw'>fam</span>, size= <span class='op'>~</span> <span class='kw'>pop</span>, PSUsamplestratum= <span class='fl'>6</span>, min_sample= <span class='fl'>8</span>,
               min_sample_index= <span class='fl'>FALSE</span>, dataAll= <span class='kw'>allocation</span>, domAll= <span class='op'>~</span> <span class='kw'>dom</span>,
               f_sample= <span class='op'>~</span> <span class='kw'>campdom</span>, planned_min_sample= <span class='kw'>NULL</span>, launch= <span class='fl'>TRUE</span>)
         
<span class='co'># It can also be written as below due to default values:</span>
<span class='kw'>Output_list</span> <span class='op'>&lt;-</span> <span class='fu'>StratSel</span>(dataPop= <span class='kw'>population</span>, idpsu= <span class='op'>~</span> <span class='kw'>comune_num</span>, dom= <span class='op'>~</span> <span class='kw'>dom</span>,
               final_pop= <span class='op'>~</span> <span class='kw'>fam</span>, size= <span class='op'>~</span> <span class='kw'>pop</span>, PSUsamplestratum= <span class='fl'>6</span>, min_sample= <span class='fl'>8</span>, 
               dataAll= <span class='kw'>allocation</span>, domAll= <span class='op'>~</span> <span class='kw'>dom</span>, f_sample= <span class='op'>~</span> <span class='kw'>campdom</span>)


<span class='co'># The function with a fixed number of final sample units (min_sample= 8)</span>
<span class='co'># to observe in each PSU and full launch of the procedure with </span>
<span class='co'># the output list composed of four data frames(see 'Value')   </span>
<span class='kw'>Output_list</span> <span class='op'>&lt;-</span> <span class='fu'>StratSel</span>(dataPop= <span class='kw'>population</span>, idpsu= <span class='op'>~</span> <span class='kw'>comune_num</span>, dom= <span class='op'>~</span> <span class='kw'>dom</span>,
               final_pop= <span class='op'>~</span> <span class='kw'>fam</span>,  size= <span class='op'>~</span> <span class='kw'>pop</span>, PSUsamplestratum= <span class='fl'>6</span>, min_sample= <span class='fl'>8</span>, 
               dataAll= <span class='kw'>allocation</span>, domAll= <span class='op'>~</span> <span class='kw'>dom</span>, f_sample= <span class='op'>~</span> <span class='kw'>campdom</span>, launch= <span class='fl'>FALSE</span>)
         

<span class='co'># The function with a variable number of final sample units (planned_min_sample= </span>
<span class='co'># ~ planned_final_sample) and partial launch of the procedure</span>
<span class='kw'>Output_list</span> <span class='op'>&lt;-</span> <span class='fu'>StratSel</span>(dataPop= <span class='kw'>population</span>, idpsu= <span class='op'>~</span> <span class='kw'>comune_num</span>, dom= <span class='op'>~</span> <span class='kw'>dom</span>, 
               final_pop= <span class='op'>~</span> <span class='kw'>fam</span>, size= <span class='op'>~</span> <span class='kw'>pop</span>, PSUsamplestratum= <span class='fl'>6</span>, min_sample= <span class='kw'>NULL</span>,
               min_sample_index= <span class='fl'>TRUE</span>, dataAll= <span class='kw'>allocation</span>, domAll= <span class='op'>~</span> <span class='kw'>dom</span>,
               f_sample= <span class='op'>~</span> <span class='kw'>campdom</span>, planned_min_sample= <span class='op'>~</span> <span class='kw'>planned_final_sample</span>)

         
<span class='co'># The function with a variable number of final sample units (planned_min_sample=</span>
<span class='co'># ~ planned_final_sample) and full launch of the procedure with the output list </span>
<span class='co'>#composed of four data frames    </span>
<span class='kw'>Output_list</span> <span class='op'>&lt;-</span> <span class='fu'>StratSel</span>(dataPop= <span class='kw'>population</span>, idpsu= <span class='op'>~</span> <span class='kw'>comune_num</span>, dom= <span class='op'>~</span> <span class='kw'>dom</span>, 
               final_pop= <span class='op'>~</span> <span class='kw'>fam</span>, size= <span class='op'>~</span> <span class='kw'>pop</span>, PSUsamplestratum= <span class='fl'>6</span>, min_sample= <span class='kw'>NULL</span>,
               min_sample_index= <span class='fl'>TRUE</span>, dataAll= <span class='kw'>allocation</span>, domAll= <span class='op'>~</span> <span class='kw'>dom</span>,
               f_sample= <span class='op'>~</span> <span class='kw'>campdom</span>, planned_min_sample= <span class='op'>~</span> <span class='kw'>planned_final_sample</span>,
               launch= <span class='fl'>FALSE</span>)     
}
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Andrea Fasulo, Stefano Falorsi, Alessio Guandalini, Daniela Pagliuca, Marco Dionisio Terribili, Raffaella Cianchetta, Giulio Barcaroli.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


